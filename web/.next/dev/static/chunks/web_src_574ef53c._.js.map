{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///F:/JGECHelper/web/src/lib/firebase.ts"],"sourcesContent":["\nimport { initializeApp, getApps, getApp } from \"firebase/app\";\nimport { getAuth } from \"firebase/auth\";\nimport { getFirestore } from \"firebase/firestore\";\nimport { getStorage } from \"firebase/storage\";\n\nconst firebaseConfig = {\n    apiKey: process.env.NEXT_PUBLIC_FIREBASE_API_KEY,\n    authDomain: process.env.NEXT_PUBLIC_FIREBASE_AUTH_DOMAIN,\n    projectId: process.env.NEXT_PUBLIC_FIREBASE_PROJECT_ID,\n    storageBucket: process.env.NEXT_PUBLIC_FIREBASE_STORAGE_BUCKET,\n    messagingSenderId: process.env.NEXT_PUBLIC_FIREBASE_MESSAGING_SENDER_ID,\n    appId: process.env.NEXT_PUBLIC_FIREBASE_APP_ID,\n};\n\n// Initialize Firebase\nconst app = !getApps().length ? initializeApp(firebaseConfig) : getApp();\n\nexport const auth = getAuth(app);\nexport const db = getFirestore(app);\nexport const storage = getStorage(app);\n"],"names":[],"mappings":";;;;;;;;AAOY;AANZ;AAAA;AACA;AAAA;AACA;AAAA;AACA;AAAA;;;;;AAEA,MAAM,iBAAiB;IACnB,MAAM;IACN,UAAU;IACV,SAAS;IACT,aAAa;IACb,iBAAiB;IACjB,KAAK;AACT;AAEA,sBAAsB;AACtB,MAAM,MAAM,CAAC,IAAA,qLAAO,IAAG,MAAM,GAAG,IAAA,2LAAa,EAAC,kBAAkB,IAAA,oLAAM;AAE/D,MAAM,OAAO,IAAA,+KAAO,EAAC;AACrB,MAAM,KAAK,IAAA,yLAAY,EAAC;AACxB,MAAM,UAAU,IAAA,qLAAU,EAAC"}},
    {"offset": {"line": 45, "column": 0}, "map": {"version":3,"sources":["file:///F:/JGECHelper/web/src/context/AuthContext.tsx"],"sourcesContent":["\"use client\";\n\nimport { createContext, useContext, useEffect, useState } from \"react\";\nimport {\n    onAuthStateChanged,\n    signInWithPopup,\n    GoogleAuthProvider,\n    signOut,\n    User,\n    signInWithEmailAndPassword,\n    createUserWithEmailAndPassword,\n    updateProfile,\n    sendPasswordResetEmail\n} from \"firebase/auth\";\nimport { auth, db } from \"@/lib/firebase\";\nimport { doc, setDoc, getDoc, serverTimestamp } from \"firebase/firestore\";\nimport { useRouter } from \"next/navigation\";\n\n// CONFIG: Admin Allowlist (Only used for FIRST login to assign initial role)\n// After the role is saved to Firestore, this list is ignored for that user.\nconst ADMIN_EMAILS = [\"sarkarpabitra1510@gmail.com\"];\n\n// Role type definitions\ntype UserRole = \"admin\" | \"user\" | null;\n\ninterface AuthContextType {\n    user: User | null;\n    role: UserRole;\n    loading: boolean;\n    signInWithGoogle: () => Promise<void>;\n    signInWithEmail: (email: string, pass: string) => Promise<void>;\n    registerWithEmail: (name: string, email: string, pass: string) => Promise<void>;\n    resetPassword: (email: string) => Promise<void>;\n    logout: () => Promise<void>;\n}\n\nconst AuthContext = createContext<AuthContextType>({} as AuthContextType);\n\nexport function AuthProvider({ children }: { children: React.ReactNode }) {\n    const [user, setUser] = useState<User | null>(null);\n    const [role, setRole] = useState<UserRole>(null);\n    const [loading, setLoading] = useState(true);\n    const router = useRouter();\n\n    useEffect(() => {\n        const unsubscribe = onAuthStateChanged(auth, async (currentUser) => {\n            setLoading(true);\n\n            if (currentUser) {\n                setUser(currentUser);\n\n                try {\n                    const userRef = doc(db, \"users\", currentUser.uid);\n                    const userSnap = await getDoc(userRef);\n\n                    if (userSnap.exists()) {\n                        // RETURNING USER: Trust Firestore Role\n                        const userData = userSnap.data();\n                        setRole(userData.role as UserRole);\n\n                        // Optional: Update last login time\n                        await setDoc(userRef, { lastLogin: serverTimestamp() }, { merge: true });\n\n                    } else {\n                        // NEW USER: Determine Role based on Allowlist\n                        const isAdmin = currentUser.email && ADMIN_EMAILS.includes(currentUser.email);\n                        const initialRole: UserRole = isAdmin ? \"admin\" : \"user\";\n\n                        // Create User Document\n                        await setDoc(userRef, {\n                            uid: currentUser.uid,\n                            email: currentUser.email,\n                            displayName: currentUser.displayName,\n                            photoURL: currentUser.photoURL,\n                            role: initialRole,\n                            createdAt: serverTimestamp(),\n                            lastLogin: serverTimestamp(),\n                        });\n\n                        setRole(initialRole);\n                    }\n                } catch (error) {\n                    console.error(\"Error fetching user role:\", error);\n                    setRole(null); // Fallback to no role on error\n                }\n\n            } else {\n                // User logged out\n                setUser(null);\n                setRole(null);\n            }\n\n            setLoading(false);\n        });\n\n        return () => unsubscribe();\n    }, []);\n\n    const signInWithGoogle = async () => {\n        const provider = new GoogleAuthProvider();\n        try {\n            await signInWithPopup(auth, provider);\n        } catch (error) {\n            console.error(\"Error signing in with Google\", error);\n            throw error;\n        }\n    };\n\n    const signInWithEmail = async (email: string, pass: string) => {\n        try {\n            await signInWithEmailAndPassword(auth, email, pass);\n        } catch (error) {\n            console.error(\"Error signing in with Email\", error);\n            throw error;\n        }\n    }\n\n    const registerWithEmail = async (name: string, email: string, pass: string) => {\n        try {\n            const result = await createUserWithEmailAndPassword(auth, email, pass);\n            await updateProfile(result.user, { displayName: name });\n\n            // Trigger the onAuthStateChanged Logic to save user to Firestore\n            // ...handled automatically by the useEffect hook when it detects the new user\n\n        } catch (error) {\n            console.error(\"Error registering\", error);\n            throw error;\n        }\n    }\n\n\n    const resetPassword = async (email: string) => {\n        try {\n            await sendPasswordResetEmail(auth, email);\n        } catch (error) {\n            console.error(\"Error resetting password\", error);\n            throw error;\n        }\n    }\n\n    const logout = async () => {\n        try {\n            await signOut(auth);\n            setRole(null);\n            setUser(null);\n            router.push(\"/\");\n        } catch (error) {\n            console.error(\"Error signing out\", error);\n        }\n    };\n\n    return (\n        <AuthContext.Provider value={{ user, role, loading, signInWithGoogle, signInWithEmail, registerWithEmail, resetPassword, logout }}>\n            {children}\n        </AuthContext.Provider>\n    );\n}\n\nexport const useAuth = () => useContext(AuthContext);\n"],"names":[],"mappings":"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"}}]
}